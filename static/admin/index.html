    async function loadConfigAndThenSignalCmsInit() {
      if (!cmsInstanceRef) {
        console.warn("loadConfigAndThenSignalCmsInit called but CMS instance not ready.");
        setTimeout(loadConfigAndThenSignalCmsInit, 100);
        return;
      }

      // --- ADD A SMALL DELAY ---
      await new Promise(resolve => setTimeout(resolve, 200)); // Wait 200ms for decap-cms.js to potentially expose jsyaml
      // --- END DELAY ---

      try {
        console.log("Attempting to fetch /admin/config.yml for manual load.");
        // ... (rest of the fetch logic remains the same) ...
        const configYAML = await response.text();
        console.log("Successfully fetched config.yml content for manual load.");

        if (window.jsyaml) { // Check again after delay
            manuallyLoadedConfig = window.jsyaml.load(configYAML);
            console.log("Parsed config.yml with window.jsyaml for manual use:", JSON.parse(JSON.stringify(manuallyLoadedConfig)));
        } else {
            console.error("window.jsyaml still not found after delay! Cannot parse config.yml. Trying to load it explicitly.");
            // --- TRY TO LOAD js-yaml EXPLICITLY ---
            try {
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js');
                if (window.jsyaml) {
                    manuallyLoadedConfig = window.jsyaml.load(configYAML);
                    console.log("Parsed config.yml with explicitly loaded window.jsyaml:", JSON.parse(JSON.stringify(manuallyLoadedConfig)));
                } else {
                    throw new Error("Failed to load js-yaml or it didn't attach to window.");
                }
            } catch (yamlLoadError) {
                console.error("Critical error loading or using js-yaml:", yamlLoadError);
                manuallyLoadedConfig = null; // Critical failure
            }
            // --- END EXPLICIT LOAD ---
        }
        // ... (rest of the function remains the same) ...
      } catch (error) {
        // ...
      }
    }

    // Helper function to load a script
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }